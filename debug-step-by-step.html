<!DOCTYPE html>
<html>
<head>
    <title>Step-by-Step Debug</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .step { margin: 15px 0; padding: 10px; border: 1px solid #0f0; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        button { background: #0f0; color: #000; border: none; padding: 10px; margin: 5px; }
        pre { background: #111; padding: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîç Step-by-Step Debug Process</h1>
    
    <div class="step">
        <h3>Step 1: Configuration Check</h3>
        <button onclick="checkConfig()">Check Config</button>
        <pre id="config-result"></pre>
    </div>
    
    <div class="step">
        <h3>Step 2: Network Connectivity</h3>
        <button onclick="checkNetwork()">Test Network</button>
        <pre id="network-result"></pre>
    </div>
    
    <div class="step">
        <h3>Step 3: Database Connection</h3>
        <button onclick="checkConnection()">Test Connection</button>
        <pre id="connection-result"></pre>
    </div>
    
    <div class="step">
        <h3>Step 4: Simple Insert</h3>
        <button onclick="testInsert()">Test Insert</button>
        <pre id="insert-result"></pre>
    </div>
    
    <div class="step">
        <h3>Step 5: Verify in Database</h3>
        <button onclick="verifyInsert()">Check Database</button>
        <pre id="verify-result"></pre>
    </div>

    <script src="supabase-config.js"></script>
    <script src="database.js"></script>
    
    <script>
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'success';
            element.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span>\n`;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        function checkConfig() {
            clearLog('config-result');
            log('config-result', 'üîß Checking Supabase configuration...');
            
            log('config-result', `URL: ${SUPABASE_CONFIG.url}`);
            log('config-result', `API Key: ${SUPABASE_CONFIG.anonKey ? SUPABASE_CONFIG.anonKey.substring(0, 30) + '...' : 'NOT SET'}`);
            
            if (!SUPABASE_CONFIG.url || SUPABASE_CONFIG.url.includes('YOUR_')) {
                log('config-result', '‚ùå Supabase URL is not configured!', 'error');
                return false;
            }
            
            if (!SUPABASE_CONFIG.anonKey || SUPABASE_CONFIG.anonKey.includes('YOUR_')) {
                log('config-result', '‚ùå Supabase API key is not configured!', 'error');
                return false;
            }
            
            log('config-result', '‚úÖ Configuration appears valid', 'success');
            return true;
        }

        async function checkNetwork() {
            clearLog('network-result');
            log('network-result', 'üåê Testing network connectivity...');
            
            try {
                const response = await fetch(SUPABASE_CONFIG.url);
                log('network-result', `Response status: ${response.status}`);
                log('network-result', `Response status text: ${response.statusText}`);
                
                if (response.status === 200 || response.status === 404) {
                    log('network-result', '‚úÖ Network connectivity OK', 'success');
                } else {
                    log('network-result', `‚ö†Ô∏è Unexpected status: ${response.status}`, 'warning');
                }
            } catch (error) {
                log('network-result', `‚ùå Network error: ${error.message}`, 'error');
            }
        }

        async function checkConnection() {
            clearLog('connection-result');
            log('connection-result', 'üì° Testing database connection...');
            
            try {
                const db = new WishlistDatabase();
                const items = await db.getAllItems();
                log('connection-result', `‚úÖ Connected! Found ${items.length} existing items`, 'success');
                
                if (items.length > 0) {
                    log('connection-result', `üìä Sample item: ${JSON.stringify(items[0], null, 2)}`);
                }
            } catch (error) {
                log('connection-result', `‚ùå Connection failed: ${error.message}`, 'error');
                log('connection-result', `‚ùå Full error: ${error.stack}`, 'error');
            }
        }

        let lastInsertId = null;

        async function testInsert() {
            clearLog('insert-result');
            log('insert-result', 'üì§ Testing database insert...');
            
            const testData = {
                name: `Debug Test ${Date.now()}`,
                price: 1.99,
                category: 'electronics',
                reason: 'Step-by-step debug test',
                url: 'https://example.com',
                imageUrl: null,
                crossedOff: false
            };
            
            log('insert-result', `Sending: ${JSON.stringify(testData, null, 2)}`);
            
            try {
                const db = new WishlistDatabase();
                const result = await db.addItem(testData);
                log('insert-result', `‚úÖ Insert successful!`, 'success');
                log('insert-result', `Result: ${JSON.stringify(result, null, 2)}`);
                lastInsertId = result.id;
            } catch (error) {
                log('insert-result', `‚ùå Insert failed: ${error.message}`, 'error');
                log('insert-result', `‚ùå Full error: ${error.stack}`, 'error');
            }
        }

        async function verifyInsert() {
            clearLog('verify-result');
            log('verify-result', 'üîç Verifying insert in database...');
            
            try {
                const db = new WishlistDatabase();
                const items = await db.getAllItems();
                log('verify-result', `üìä Total items in database: ${items.length}`);
                
                if (lastInsertId) {
                    const inserted = items.find(item => item.id === lastInsertId);
                    if (inserted) {
                        log('verify-result', '‚úÖ Last inserted item found in database!', 'success');
                        log('verify-result', `Item: ${JSON.stringify(inserted, null, 2)}`);
                    } else {
                        log('verify-result', '‚ùå Last inserted item NOT found in database!', 'error');
                    }
                } else {
                    log('verify-result', '‚ö†Ô∏è No recent insert to verify', 'warning');
                }
                
                if (items.length > 0) {
                    log('verify-result', 'üìã All items in database:');
                    items.forEach((item, index) => {
                        log('verify-result', `${index + 1}. ${item.name} (ID: ${item.id})`);
                    });
                }
                
            } catch (error) {
                log('verify-result', `‚ùå Verification failed: ${error.message}`, 'error');
            }
        }

        // Auto-run first two steps
        setTimeout(() => {
            checkConfig();
            setTimeout(checkNetwork, 1000);
        }, 500);
    </script>
</body>
</html>
