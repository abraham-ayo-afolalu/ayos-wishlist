<!DOCTYPE html>
<html>
<head>
    <title>Manual Supabase Test</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #0f0; }
        button { background: #0f0; color: #000; border: none; padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîß Manual Supabase Test</h1>
    <div id="results"></div>
    
    <button onclick="testRawFetch()">Test Raw Fetch</button>
    <button onclick="testWithCurl()">Show cURL Command</button>

    <script src="supabase-config.js"></script>
    
    <script>
        function log(message) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            results.appendChild(div);
            console.log(message);
        }

        async function testRawFetch() {
            log('üß™ Testing raw fetch to Supabase...');
            
            const url = `${SUPABASE_CONFIG.url}/rest/v1/wishlist_items`;
            const headers = {
                'Content-Type': 'application/json',
                'apikey': SUPABASE_CONFIG.anonKey,
                'Authorization': `Bearer ${SUPABASE_CONFIG.anonKey}`,
                'Prefer': 'return=representation'
            };
            
            const body = {
                name: 'Manual Test Item',
                price: 123.45,
                category: 'electronics',
                reason: 'Manual testing',
                url: 'https://example.com',
                image_url: null,
                crossed_off: false
            };
            
            log('üì§ URL: ' + url);
            log('üìã Headers: ' + JSON.stringify(headers, null, 2));
            log('üì¶ Body: ' + JSON.stringify(body, null, 2));
            
            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(body)
                });
                
                log('üì® Response Status: ' + response.status);
                log('üì® Response Status Text: ' + response.statusText);
                
                // Get all response headers
                const responseHeaders = {};
                for (let [key, value] of response.headers.entries()) {
                    responseHeaders[key] = value;
                }
                log('üì® Response Headers: ' + JSON.stringify(responseHeaders, null, 2));
                
                // Get response text
                const responseText = await response.text();
                log('üì® Raw Response Text: "' + responseText + '"');
                log('üì® Response Length: ' + responseText.length);
                
                if (response.ok) {
                    if (responseText.trim()) {
                        try {
                            const parsed = JSON.parse(responseText);
                            log('‚úÖ Successfully parsed JSON: ' + JSON.stringify(parsed, null, 2));
                        } catch (e) {
                            log('‚ùå JSON parse error: ' + e.message);
                        }
                    } else {
                        log('‚ö†Ô∏è Empty response but status OK - this is normal for some Supabase configurations');
                    }
                } else {
                    log('‚ùå Request failed with status: ' + response.status);
                }
                
            } catch (error) {
                log('‚ùå Fetch error: ' + error.message);
            }
        }

        function testWithCurl() {
            const curlCommand = `curl -X POST "${SUPABASE_CONFIG.url}/rest/v1/wishlist_items" \\
  -H "Content-Type: application/json" \\
  -H "apikey: ${SUPABASE_CONFIG.anonKey}" \\
  -H "Authorization: Bearer ${SUPABASE_CONFIG.anonKey}" \\
  -H "Prefer: return=representation" \\
  -d '{
    "name": "cURL Test Item",
    "price": 99.99,
    "category": "electronics",
    "reason": "Testing with cURL",
    "url": "https://example.com",
    "image_url": null,
    "crossed_off": false
  }'`;
            
            log('üíª cURL Command to test manually:');
            log(curlCommand);
            log('üìã Copy this command and run it in your terminal to test Supabase directly');
        }
    </script>
</body>
</html>
